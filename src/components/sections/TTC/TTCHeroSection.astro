---
interface Props {
  images: string[];
  title: string;
  details: Array<{ label: string; value: string }>;
  fees: {
    single: { amount: string; description: string };
    double: { amount: string; description: string };
    withoutStay: { amount: string; description: string };
  };
  contactRoute: string;
}

const { images, title, details, fees, contactRoute } = Astro.props;
const [titleLine1, titleLine2] = title.split('\n');
import Button from '$components/ui/Button.astro';
---

<div class="block min-h-[50vh] w-full flex-col md:flex md:min-h-screen md:flex-row">
  <!-- Carousel -->
  <div
    class="relative h-[350px] w-full flex-none overflow-hidden rounded-t-2xl bg-gradient-to-br from-purple-100 to-orange-100 md:h-screen md:w-2/3 md:rounded-l-2xl"
    id="carousel-container"
  >
    <!-- Main Image -->
    <img
      alt="Training course image"
      class="h-full w-full object-cover transition-all duration-500 ease-in-out"
      id="carousel-image"
      src={images[0]}
    />
    
    <!-- Navigation Buttons -->
    <button
      class="absolute left-4 top-1/2 z-20 -translate-y-1/2 rounded-full bg-black/50 p-3 backdrop-blur-sm transition-all hover:bg-black/70 md:p-4"
      id="prev-btn"
    >
      <i class="fas fa-chevron-left text-white text-lg md:text-xl"></i>
    </button>
    <button 
      class="absolute right-4 top-1/2 z-20 -translate-y-1/2 rounded-full bg-black/50 p-3 backdrop-blur-sm transition-all hover:bg-black/70 md:p-4" 
      id="next-btn"
    >
      <i class="fas fa-chevron-right text-white text-lg md:text-xl"></i>
    </button>

    <!-- Dots Indicator -->
    <div class="absolute bottom-4 left-1/2 z-20 flex -translate-x-1/2 space-x-2" id="dots-container">
      {images.map((_, index) => (
        <button
          class:list={[`h-3 w-3 rounded-full transition-all duration-300`,{"bg-white": index === 0, "bg-white/50": index !== 0}]}
          data-index={index}
          id={`dot-${index}`}
        ></button>
      ))}
    </div>

    <!-- Image Counter -->
    <div class="absolute top-4 right-4 z-20 rounded-full bg-black/50 px-3 py-1 text-white backdrop-blur-sm">
      <span id="current-index">1</span>/<span>{images.length}</span>
    </div>
  </div>

  <!-- Info Panel -->
  <div
    class="flex h-auto w-full items-center overflow-hidden rounded-b-2xl md:h-screen md:w-1/3 md:rounded-r-2xl"
  >
    <div class="font-inter h-full w-full space-y-2 bg-white p-3 shadow-lg md:space-y-3 md:p-4">
      <h2
        class="mt-2 text-center text-xl font-bold leading-tight text-purple-600 md:text-left md:text-2xl lg:mt-5 lg:text-3xl"
      >
        <span class="text-4xl">{titleLine1}</span>
        <br />{titleLine2}
      </h2>
      <div class="space-y-1 pt-0 md:space-y-2 lg:pt-10">
        {
          details.map(({ label, value }, idx) => (
            <div
              class:list={[
                `flex justify-between whitespace-nowrap font-space text-lg font-black md:text-base`,
                `pb-1`,
                { 'border-b border-gray-700': idx === 0, 'border-b border-gray-200': idx !== 0 },
              ]}
            >
              <div class="text-orange-600">
                <span>â—†</span>
                <span class="">{label}:</span>
              </div>
              <span>{value}</span>
            </div>
          ))
        }
      </div>

      <!-- Fees -->
      <div class="">
        <h3 class="mb-1 text-center text-lg font-bold text-primary md:mb-2 md:text-xl">
          Course Fee:
        </h3>
        <div class="grid grid-cols-1 gap-1 md:grid-cols-2 md:gap-2">
          <div class="rounded-lg border border-primary bg-primary/10 p-1 md:p-2">
            <div class="text-xl font-bold text-primary md:text-2xl">
              {fees.single.amount}
            </div>
            <div class="text-sm text-primary">{fees.single.description}</div>
          </div>
          <div class="rounded-lg border border-primary bg-primary/10 p-1 md:p-2">
            <div class="text-xl font-bold text-primary md:text-2xl">
              {fees.double.amount}
            </div>
            <div class="text-sm text-primary">{fees.double.description}</div>
          </div>
        </div>
        <div>
        <h3 class="mb-1 text-center text-lg font-bold text-primary md:mb-2 md:text-xl">
          Course Fee Without Stay:
        </h3>
        <div class="grid grid-cols-1 md:place-items-center">
          <div class="rounded-lg border border-primary bg-primary/10 p-1 md:p-2">
            <div class="text-xl font-bold text-primary md:text-2xl">
              {fees.withoutStay.amount}
            </div>
            <div class="text-sm text-primary">
              {fees.withoutStay.description}
            </div>
          </div>
        </div>
      </div>
      </div>

      

      <div class="pt-1 text-center md:pt-2">
        <Button
          class="cursor-pointer rounded-md bg-gradient-to-r from-primary to-purple-600 px-4 py-2 text-3xl font-light text-white transition-colors hover:from-purple-600 hover:to-purple-700"
          href={contactRoute}
        >
          Book Now
        </Button>
      </div>
    </div>
  </div>
</div>

<!-- Carousel Script -->
<script defer define:vars={{ images }}>
  let i = 0;
  const img = document.getElementById('carousel-image');
  const prev = document.getElementById('prev-btn');
  const next = document.getElementById('next-btn');
  const container = document.getElementById('carousel-container');
  let t;

  function update() {
    img.src = images[i];
  }
  function start() {
    t = setInterval(() => {
      i = (i + 1) % images.length;
      update();
    }, 2500);
  }
  function stop() {
    clearInterval(t);
  }

  if (img && prev && next && container) {
    update();
    start();
    container.addEventListener('mouseenter', stop);
    container.addEventListener('mouseleave', start);
    prev.addEventListener('click', () => {
      stop();
      i = (i - 1 + images.length) % images.length;
      update();
      start();
    });
    next.addEventListener('click', () => {
      stop();
      i = (i + 1) % images.length;
      update();
      start();
    });
  }
</script>
