---
// src/layouts/SEOLayout.astro
import type { SEOProps } from '../utils/seo-utils';
import { sanitizeJSON } from '../utils/sanitize';
import { SITE_METADATA } from '../lib/yoga-seo-constants';
import { generateHreflangAlternates } from '../utils/seo-utils';

interface Props extends SEOProps {
  frontmatter?: {
    title?: string;
    description?: string;
    keywords?: string[];
    author?: string;
    publishDate?: string;
  };
  currentPath?: string;
}

const {
  title,
  description,
  canonical,
  noindex = false,
  openGraph,
  additionalMetaTags = [],
  additionalLinkTags = [],
  structuredData,
  frontmatter = {},
  currentPath = '/',
} = Astro.props;

// Use props title/description or fallback to frontmatter or defaults
const pageTitle = title || frontmatter.title || SITE_METADATA.defaultTitle;
const pageDescription = description || frontmatter.description || SITE_METADATA.defaultDescription;
const pageKeywords = frontmatter.keywords?.join(', ') || '';

// Generate hreflang alternates for current path
const hreflangAlternates = generateHreflangAlternates(currentPath);

// Open Graph defaults
const ogTitle = openGraph?.title || pageTitle;
const ogDescription = openGraph?.description || pageDescription;
const ogUrl = openGraph?.url || `${SITE_METADATA.siteUrl}${currentPath}`;
const ogImage = openGraph?.images?.[0]?.url || `${SITE_METADATA.siteUrl}/og-default.jpg`;
const ogType = openGraph?.type || 'website';
const ogSiteName = openGraph?.siteName || SITE_METADATA.siteName;
---

<!doctype html>
<html class="scroll-smooth" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta content={Astro.generator} name="generator" />

    <!-- Primary Meta Tags -->
    <title>{pageTitle}</title>
    <meta content={pageDescription} name="description" />
    {pageKeywords && <meta content={pageKeywords} name="keywords" />}
    {canonical && <link href={canonical} rel="canonical" />}
    {noindex && <meta content="noindex, nofollow" name="robots" />}

    <!-- Favicon and Icons -->
    <link href="/favicon.ico" rel="icon" type="image/x-icon" />
    <link href="/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180" />
    <link href="/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png" />
    <link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png" />
    <link href="/site.webmanifest" rel="manifest" />

    <!-- Open Graph / Facebook -->
    <meta content={ogType} property="og:type" />
    <meta content={ogTitle} property="og:title" />
    <meta content={ogDescription} property="og:description" />
    <meta content={ogUrl} property="og:url" />
    <meta content={ogSiteName} property="og:site_name" />
    <meta content={ogImage} property="og:image" />
    <meta content="1200" property="og:image:width" />
    <meta content="630" property="og:image:height" />
    <meta content="en_US" property="og:locale" />

    <!-- Twitter -->
    <meta content="summary_large_image" name="twitter:card" />
    <meta content={ogTitle} name="twitter:title" />
    <meta content={ogDescription} name="twitter:description" />
    <meta content={ogImage} name="twitter:image" />
    <meta content="@hathayogashram" name="twitter:site" />
    <meta content="@hathayogashram" name="twitter:creator" />

    <!-- Additional Meta Tags -->
    {
      additionalMetaTags.map(tag =>
        tag.name ? (
          <meta content={tag.content} name={tag.name} />
        ) : tag.property ? (
          <meta content={tag.content} property={tag.property} />
        ) : tag.httpEquiv ? (
          <meta content={tag.content} http-equiv={tag.httpEquiv} />
        ) : null
      )
    }

    <!-- Hreflang Links -->
    {
      hreflangAlternates.map(alternate => (
        <link href={alternate.href} hreflang={alternate.hreflang} rel="alternate" />
      ))
    }

    <!-- Additional Link Tags -->
    {
      additionalLinkTags.map(tag => (
        <link
          href={tag.href}           rel={tag.rel}
          {...(tag.sizes && { sizes: tag.sizes })}
          {...(tag.type && { type: tag.type })}
        />
      ))
    }

<!-- Structured Data -->
    {
      structuredData && (
        <script type="application/ld+json">{sanitizeJSON(structuredData)}</script>
      )
    }

    <!-- Author and Publication Info -->
    {frontmatter.author && <meta content={frontmatter.author} name="author" />}
    {
      frontmatter.publishDate && (
        <meta content={frontmatter.publishDate} name="article:published_time" />
      )
    }

    <!-- Preconnect to external domains for performance -->
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin href="https://fonts.gstatic.com" rel="preconnect" />

    <!-- DNS Prefetch for external resources -->
    <link href="//www.google-analytics.com" rel="dns-prefetch" />
    <link href="//www.googletagmanager.com" rel="dns-prefetch" />

    <!-- Geo Tags for Rishikesh Location -->
    <meta content="IN-UT" name="geo.region" />
    <meta content="Rishikesh, Uttarakhand, India" name="geo.placename" />
    <meta content="30.0869;78.2676" name="geo.position" />
    <meta content="30.0869, 78.2676" name="ICBM" />

    <!-- Business Information -->
    <meta content="Mo-Su 06:00-20:00" name="business:hours" />
    <meta content={SITE_METADATA.contactInfo.phone} name="business:contact_data:phone_number" />
    <meta content={SITE_METADATA.contactInfo.email} name="business:contact_data:email" />

    <!-- Performance and Cache Control -->
    <meta content="public, max-age=31536000" http-equiv="Cache-Control" />
    <meta content="#059669" name="theme-color" />

    <style>
      /* Critical CSS for above-the-fold content */
      body {
        font-family:
          system-ui,
          -apple-system,
          sans-serif;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>

  <body>
    <slot />

    <!-- Schema.org Organization structured data -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": "Hatha Yogashram",
        "url": "https://hathayogashram.com",
        "logo": "https://hathayogashram.com/logo.png",
        "contactPoint": {
          "@type": "ContactPoint",
          "telephone": "+91-1234567890",
          "contactType": "customer service"
        },
        "address": {
          "@type": "PostalAddress",
          "streetAddress": "Laxman Jhula Road",
          "addressLocality": "Rishikesh",
          "addressRegion": "Uttarakhand",
          "postalCode": "249302",
          "addressCountry": "IN"
        },
        "sameAs": [
          "https://www.facebook.com/hathayogashram",
          "https://www.instagram.com/hathayogashram",
          "https://twitter.com/hathayogashram",
          "https://www.youtube.com/hathayogashram"
        ]
      }
    </script>
  </body>
</html>
