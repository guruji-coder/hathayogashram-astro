---
// src/layouts/SEOLayout.astro
import type { SEOProps } from "../utils/seo-utils";
import { SITE_METADATA } from "../lib/yoga-seo-constants";
import { generateHreflangAlternates } from "../utils/seo-utils";

interface Props extends SEOProps {
  frontmatter?: {
    title?: string;
    description?: string;
    keywords?: string[];
    author?: string;
    publishDate?: string;
  };
  currentPath?: string;
}

const {
  title,
  description,
  canonical,
  noindex = false,
  openGraph,
  additionalMetaTags = [],
  additionalLinkTags = [],
  structuredData,
  frontmatter = {},
  currentPath = "/",
} = Astro.props;

// Use props title/description or fallback to frontmatter or defaults
const pageTitle = title || frontmatter.title || SITE_METADATA.defaultTitle;
const pageDescription =
  description || frontmatter.description || SITE_METADATA.defaultDescription;
const pageKeywords = frontmatter.keywords?.join(", ") || "";

// Generate hreflang alternates for current path
const hreflangAlternates = generateHreflangAlternates(currentPath);

// Open Graph defaults
const ogTitle = openGraph?.title || pageTitle;
const ogDescription = openGraph?.description || pageDescription;
const ogUrl = openGraph?.url || `${SITE_METADATA.siteUrl}${currentPath}`;
const ogImage =
  openGraph?.images?.[0]?.url || `${SITE_METADATA.siteUrl}/og-default.jpg`;
const ogType = openGraph?.type || "website";
const ogSiteName = openGraph?.siteName || SITE_METADATA.siteName;
---

<!doctype html>
<html lang="en" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content={Astro.generator} />

    <!-- Primary Meta Tags -->
    <title>{pageTitle}</title>
    <meta name="description" content={pageDescription} />
    {pageKeywords && <meta name="keywords" content={pageKeywords} />}
    {canonical && <link rel="canonical" href={canonical} />}
    {noindex && <meta name="robots" content="noindex, nofollow" />}

    <!-- Favicon and Icons -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content={ogType} />
    <meta property="og:title" content={ogTitle} />
    <meta property="og:description" content={ogDescription} />
    <meta property="og:url" content={ogUrl} />
    <meta property="og:site_name" content={ogSiteName} />
    <meta property="og:image" content={ogImage} />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:locale" content="en_US" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={ogTitle} />
    <meta name="twitter:description" content={ogDescription} />
    <meta name="twitter:image" content={ogImage} />
    <meta name="twitter:site" content="@hathayogashram" />
    <meta name="twitter:creator" content="@hathayogashram" />

    <!-- Additional Meta Tags -->
    {
      additionalMetaTags.map((tag) =>
        tag.name ? (
          <meta name={tag.name} content={tag.content} />
        ) : tag.property ? (
          <meta property={tag.property} content={tag.content} />
        ) : tag.httpEquiv ? (
          <meta http-equiv={tag.httpEquiv} content={tag.content} />
        ) : null,
      )
    }

    <!-- Hreflang Links -->
    {
      hreflangAlternates.map((alternate) => (
        <link
          rel="alternate"
          hreflang={alternate.hreflang}
          href={alternate.href}
        />
      ))
    }

    <!-- Additional Link Tags -->
    {
      additionalLinkTags.map((tag) => (
        <link
          rel={tag.rel}
          href={tag.href}
          {...(tag.sizes && { sizes: tag.sizes })}
          {...(tag.type && { type: tag.type })}
        />
      ))
    }

    <!-- Structured Data -->
    {
      structuredData && (
        <script
          type="application/ld+json"
          set:html={JSON.stringify(structuredData)}
        />
      )
    }

    <!-- Author and Publication Info -->
    {frontmatter.author && <meta name="author" content={frontmatter.author} />}
    {
      frontmatter.publishDate && (
        <meta name="article:published_time" content={frontmatter.publishDate} />
      )
    }

    <!-- Preconnect to external domains for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

    <!-- DNS Prefetch for external resources -->
    <link rel="dns-prefetch" href="//www.google-analytics.com" />
    <link rel="dns-prefetch" href="//www.googletagmanager.com" />

    <!-- Geo Tags for Rishikesh Location -->
    <meta name="geo.region" content="IN-UT" />
    <meta name="geo.placename" content="Rishikesh, Uttarakhand, India" />
    <meta name="geo.position" content="30.0869;78.2676" />
    <meta name="ICBM" content="30.0869, 78.2676" />

    <!-- Business Information -->
    <meta name="business:hours" content="Mo-Su 06:00-20:00" />
    <meta
      name="business:contact_data:phone_number"
      content={SITE_METADATA.contactInfo.phone}
    />
    <meta
      name="business:contact_data:email"
      content={SITE_METADATA.contactInfo.email}
    />

    <!-- Performance and Cache Control -->
    <meta http-equiv="Cache-Control" content="public, max-age=31536000" />
    <meta name="theme-color" content="#059669" />

    <style>
      /* Critical CSS for above-the-fold content */
      body {
        font-family:
          system-ui,
          -apple-system,
          sans-serif;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>

  <body>
    <slot />

    <!-- Schema.org Organization structured data -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": "Hatha Yogashram",
        "url": "https://hathayogashram.com",
        "logo": "https://hathayogashram.com/logo.png",
        "contactPoint": {
          "@type": "ContactPoint",
          "telephone": "+91-1234567890",
          "contactType": "customer service"
        },
        "address": {
          "@type": "PostalAddress",
          "streetAddress": "Laxman Jhula Road",
          "addressLocality": "Rishikesh",
          "addressRegion": "Uttarakhand",
          "postalCode": "249302",
          "addressCountry": "IN"
        },
        "sameAs": [
          "https://www.facebook.com/hathayogashram",
          "https://www.instagram.com/hathayogashram",
          "https://twitter.com/hathayogashram",
          "https://www.youtube.com/hathayogashram"
        ]
      }
    </script>
  </body>
</html>
